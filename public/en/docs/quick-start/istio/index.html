<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.86.0" />
<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/mosn.io/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/mosn.io/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/mosn.io/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/mosn.io/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/mosn.io/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/mosn.io/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/mosn.io/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/mosn.io/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/mosn.io/favicons/android-192x192.png" sizes="192x192">

<title>Use MOSN as an Istio data plane | MOSN</title><meta property="og:title" content="Use MOSN as an Istio data plane" />
<meta property="og:description" content="This topic shows you how to build a Service Mesh development environment with MOSN under the Istio framework, and verify the basic routing and load balancing capabilities of MOSN.
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://https://mosn.io/en/docs/quick-start/istio/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2020-01-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-12-03T23:48:06+08:00" /><meta property="og:site_name" content="MOSN" />

<meta itemprop="name" content="Use MOSN as an Istio data plane">
<meta itemprop="description" content="This topic shows you how to build a Service Mesh development environment with MOSN under the Istio framework, and verify the basic routing and load balancing capabilities of MOSN.
"><meta itemprop="datePublished" content="2020-01-20T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-12-03T23:48:06+08:00" />
<meta itemprop="wordCount" content="1083">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Use MOSN as an Istio data plane"/>
<meta name="twitter:description" content="This topic shows you how to build a Service Mesh development environment with MOSN under the Istio framework, and verify the basic routing and load balancing capabilities of MOSN.
"/>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-93485976-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




<link rel="preload" href="/mosn.io/scss/main.min.6c022a2695e1b7248646a4d8e9854baa2e7b3dec122dbfd8d0a958f44f5392f8.css" as="style">
<link href="/mosn.io/scss/main.min.6c022a2695e1b7248646a4d8e9854baa2e7b3dec122dbfd8d0a958f44f5392f8.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>





    <title>Use MOSN as an Istio data plane | MOSN</title>
  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/mosn.io/en/">
		<span class="navbar-logo"><svg width="303" height="259" viewBox="0 0 303 259" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>brpc_logo.svg</title><defs><linearGradient x1="50%" y1="0" x2="50%" y2="100%" id="linearGradient-1"><stop stop-color="#b5b5b5" offset="0"/><stop stop-color="#7e7e7e" offset="100%"/></linearGradient><linearGradient x1="50%" y1="0" x2="50%" y2="100%" id="linearGradient-2"><stop stop-color="#b5b5b5" offset="0"/><stop stop-color="#7e7e7e" offset="100%"/></linearGradient><linearGradient x1="50%" y1="0" x2="50%" y2="100%" id="linearGradient-3"><stop stop-color="#b5b5b5" offset="0"/><stop stop-color="#7e7e7e" offset="100%"/></linearGradient><linearGradient x1="50%" y1="0" x2="50%" y2="100%" id="linearGradient-4"><stop stop-color="#b5b5b5" offset="0"/><stop stop-color="#7e7e7e" offset="100%"/></linearGradient></defs><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><circle id="椭圆形" fill="#58b8ff" cx="23.5" cy="62.5" r="23.5"/><circle id="椭圆形" fill="#58b8ff" cx="279.5" cy="60.5" r="23.5"/><circle id="椭圆形" fill="#58b8ff" cx="119" cy="26" r="26"/><rect id="矩形" fill="#58b8ff" transform="translate(78.021813, 41.967662) rotate(-22.000000) translate(-78.021813, -41.967662)" x="30.0218125" y="35.9676616" width="96" height="12"/><rect id="矩形" fill="#58b8ff" transform="translate(201.451088, 44.299021) rotate(13.000000) translate(-201.451088, -44.299021)" x="138.951088" y="38.2990214" width="125" height="12"/><g id="brpc-logo" transform="translate(11.000000, 104.000000)" fill-rule="nonzero"><g id="编组" transform="translate(138.000000, 77.419111) scale(-1, 1) rotate(-180.000000) translate(-138.000000, -77.419111) translate(0.000000, 0.000000)"><path d="M18.8 154.3C17.8 154.1 17 153.8 17 153.6 17 153.5 13.2 134.3 8.5 111 3.8 87.7-205355861e-22 68-205355861e-22 67.4-205355861e-22 65.9 2.6 65.3 5.7 65.8 7.3 66.1 8.1 67.2 8.6 69.6 9.3 73.5 10 73.8 11.7 71.1 15 65.9 28.8 63.2 36.4 66.4 48.9 71.6 57.7 89.6 56.8 108.1c-.5 10-2.5 14.5-7.8 17.1C44.5 127.5 36.6 127.5 31.4 125.1 27 123.1 20.8814242 116.827994 20 115.8 19.8268414 115.598047 19.5 115 19 115.2 18.3 115.4 18.3 116.5 19 118.7 19.6 120.4 21.6 129 23.4 137.8l3.3 16L24.6 154.4C22.3 155 21.4 155 18.8 154.3zm24.6146505-36.885789c1.7578246-1.326292 2.0864078-1.825452 2.4530432-2.642066S46.8138702 112.705545 47.1008328 111.513935C48.333925 109.104457 47.0101697 95.2413285 45.0724535 89.7736686 41.197021 79.2090375 34.9434822 73 28.2495534 73c-4.5800565.0-7.4866309 1.5754274-11.5382193 6.1163653-1.6734822 1.8534441-1.598743 2.8514069-2.0391331 4.4738936C14.2318109 85.2127457 15.3810952 94.5991493 17.4068894 98.6767262 18.5085881 100.995054 18.5085881 100.995054 20.3179492 104.427606 20.9381193 105.604136 23.3268821 108.69306 24.5063492 109.790864c1.2349847 1.149478 2.6574201 2.834639 3.7432042 3.921533 1.1506404 1.15181600000001 4.2465085 3.084017 5.3028342 3.701814 1.4321645.837608000000003 2.774919 1.362015 4.0282636 1.573221C40.1349135 119.080104 41.2462694 118.670624 43.4146505 117.414211z" id="形状" fill="url(#linearGradient-1)"/><path d="M248.7 148.9C241 147.8 232.2 143 226.1 136.5c-14.2-15-20-43.1-12.1-58.6C216.6 72.9 223.2 67.5 228.5 66 235.2 64.1 249.3 65.1 255.7 67.9 258.6 69.2 261.4 70.8 262.1 71.6 263.7 73.5 265 79.9 263.9 80.6 263.4 80.9 260 79.6 256.3 77.8 243 71.3 230.4 73.3 225.1 82.9 218.5 94.9 223.7 119.3 235.5 131.5 245.8 142 257.4 142.9 271.3 134.2 273.7 132.7 274.2 132.7 275 134 275.5 134.8 276 137.2 276 139.2 276 142.2 275.5 143.2 272.8 144.8 266.2 148.7 257.7 150.2 248.7 148.9z" id="路径" fill="#fff"/><path d="M87.4 148.1C86.2 147.6 84.9 146.7 84.6 146.1 83.6 144.5 68.1 66.6 68.7 65.8c.599999999999994-1 7.5-1 9 0C78.4 66.3 80.6 74.4 82.5 83.9s3.7 17.6 4 18.2C87.5 103.6 96.3 103.1 99.9 101.2 105.7 98.3 107.2 95.2 110 79.7l2.5-14.2L117.3 65.2C123.5 64.8 123.7 65.7 121.6 78.4c-2.5 14.4-4.5 21.2-7.3 24.2C113 104 112 105.3 112.2 105.5 112.4 105.6 114.3 106.7 116.5 107.8 124.5 111.9 129.8 119.6 130.7 128.5 131.7 138 127.9 143.9 119 146.9 114.5 148.4 90.2 149.3 87.4 148.1zm24.9-9.5C117.8 136.3 119.3 133.8 118.8 127.7 117.9 117 111.3 112.1 96.6 111.2L87.7 110.7 88.3 113.1C88.6 114.4 89.8 120.5 91 126.5 92.1 132.6 93.3 138.1 93.5 138.8 94.1 140.5 108.1 140.4 112.3 138.6z" id="形状" fill="#fff"/><path d="M159.5 148.4C158.4 148.1 157.2 147.5 156.7 147.1c-1-1-16.8-80.2-16.1-81.2C141.2 64.8 148 64.7 149.7 65.8 150.3 66.2 152.2 73.3 153.8 81.5L156.7 96.5 167.8 97.1c17.1 1 25.5 5.7 31.2 17.2C206.2 129.1 202.4 143.6 190.5 146.9 186.1 148.1 162.6 149.2 159.5 148.4zm27.2-11C195 131.2 191.3 114.2 180.5 108.6 177.6 107.1 174.2 106.4 167.8 106.2 162.9 106 159 106.2 159 106.7 159 107.1 160.4 114.9 162.1 123.9L165.3 140.2 174.6 139.8C182.1 139.5 184.5 139 186.7 137.4z" id="形状" fill="#fff"/><path d="M52.3 50.7C49 41.2 49.5 37.5 52.9 46.5c1.2 3.1 1.9876864 5.9098389 2.1 6.3S55.4 54.1 55.9 54.9C56.6 56 58.2 55.2 63.5 50.9 67.2 47.9 70.4 45.6 70.6 45.8 71.7 46.5 70.9 47.4 64.1 53.2 60 56.6 58.2983882 57.6981689 57.4 58.2 56.5016118 58.7018311 56.5016118 58.7018311 55.8 58.2 55 57.49737 54 55.4 52.3 50.7z" id="形状" fill="#7e7e7e"/><path d="M84 34.1C84 30.6 82.8 29 80.4 29 78.9 29 78 28.4 78 27.5 78 26.7 78.9 26 80 26 82.4 26 82.4 25.5 80.5 17 79.7 13.4 79.1 8.4 79 5.8 79 1.6 79.3 1 81.4.4 85.1-.5 89.5.3 89.8 2 90 3.1 89.2 3.5 86.8 3.5 83.9 3.5 83.5 3.8 83.3 6.5 83.1 8.2 83.8 13.1 84.8 17.5c1.7 7.9 1.7 8 5.2 8.6L93.5 26.7C94.2848943 26.7875501 94.751561 26.9875501 94.9 27.3 95 28.6 94.2 29 91.1 29h-4L87.7 32.5C88.2 35.6 88 36 86.1 36 84.7 36 84 35.4 84 34.1z" id="形状" fill="url(#linearGradient-2)"/><path d="M105 34.1C105 30.6 103.8 29 101.4 29 99.9 29 99 28.4 99 27.5 99 26.7 99.9 26 101 26 103.4 26 103.4 25.5 101.5 17 100.7 13.4 100.1 8.4 1e2 5.8 1e2 1.6 100.3 1 102.4.4 106.1-.5 110.5.3 110.8 2 111 3.1 110.2 3.5 107.8 3.5 104.9 3.5 104.5 3.8 104.3 6.5 104.1 8.2 104.8 13.1 105.8 17.5c1.7 7.9 1.7 8 5.2 8.6L114.5 26.7C115.433333 26.8462934 115.9 27.0462934 115.9 27.3 116 28.6 115.2 29 112.1 29h-4L108.7 32.5C109.2 35.6 109 36 107.1 36 105.7 36 105 35.4 105 34.1z" id="形状" fill="url(#linearGradient-2)"/><path d="M54.3 26.9c-4.5-2.9-7.7-10-7.8-17.2C46.5 1.9 48.6.0 57.2.0 63.6.0 67 1.2 67 3.6 67 4.7 66.6 4.8 65.1 4c-2.7-1.4-10.4-1.3-12.4.3C51.8 4.9 51 6.6 50.9 8 50.4 13.5 50.6 13.7 57.8 14.2 66 14.9 69.5 16.4 71 20 72.3 23.2 71.2 26.3 68 28s-10.2 1.1-13.7-1.1zM67 22.7C67 19 63.6 17 57.3 17 54.4 17 52 17.3 52 17.8c0 1.1 3.1 5.4 5 7C57.9 25.5 60.2 25.9 62.8 25.7 65.1 25.4 67 26.1 67 22.7z" id="形状" fill="url(#linearGradient-3)"/><path d="M126.3 26.9c-4.5-2.9-7.7-10-7.8-17.2C118.5 1.9 120.6.0 129.2.0 135.6.0 139 1.2 139 3.6 139 4.7 138.6 4.8 137.1 4 134.4 2.6 126.7 2.7 124.7 4.3 123.8 4.9 123 6.6 122.9 8 122.4 13.5 122.6 13.7 129.8 14.2 138 14.9 141.5 16.4 143 20 144.3 23.2 143.2 26.3 140 28s-10.2 1.1-13.7-1.1zM139 22.7C139 19 135.6 17 129.3 17 126.4 17 124 17.3 124 17.8 124 18.9 127.1 23.2 129 24.8 129.9 25.5 132.2 25.9 134.8 25.7 137.1 25.4 139 26.1 139 22.7z" id="形状" fill="url(#linearGradient-3)"/><path d="M153.7 26.8C151.7 18.4 149.2978 2.90464869 149.2978 2.1 149.2978 1.77371339 148.894918.241544332 150.3.1 151.705082-.0415443324 153 .4 153 2.1 153 3.2 153.7 7.2 154.6 11 156.5 19.3 161 25.2 165.5 25.4 167.5 25.5 168.6 26.1 168.8 27.3 169.1 28.6 168.4 29 165.8 29 163.2 29 161.6 28.2 159.4 25.8L156.5 22.5C155.5 19.6333333 155.133333 18.4333333 155.4 18.9 155.9 19.7 156.5 22.2 156.7 24.6 156.9 27.9 156.7 29 155.6 29 154.8 29 154 28 153.7 26.8z" id="形状" fill="url(#linearGradient-4)"/></g></g></g></svg></span>
        
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://github.com/mosn/mosn/" target="_blank" ><span>GitHub</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link active" href="/mosn.io/en/docs/" ><span class="active">Docs</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/mosn.io/en/blog/" ><span>Blog</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/mosn.io/en/docs/community/" ><span>Community</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/mosn.io/en/docs/faq/" ><span>FAQ</span></a>
			</li>
			
			
			
			<li class="nav-item dropdown d-none d-lg-block">
				

<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	English
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="/mosn.io/docs/quick-start/istio/">中文</a>
	
</div>
			</li>
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
<input type="search" class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete="off">
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <form class="td-sidebar__search d-flex align-items-center">
    
<input type="search" class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete="off">

    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  
  <nav class="collapse td-sidebar-nav pt-2 pl-4" id="td-section-nav">
    
    <div class="nav-item dropdown d-block d-lg-none">
      

<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	English
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="/mosn.io/docs/quick-start/istio/">中文</a>
	
</div>
    </div>
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/mosn.io/en/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Docs</a>
  </li>
  <ul>
    <li class="collapse show" id="mosnioendocs">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocsoverview" href="/mosn.io/en/docs/overview/">Overview</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocsdevfeaturegate-introduce" href="/mosn.io/en/docs/dev/featuregate-introduce/">FeatureGate overview</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/mosn.io/en/docs/quick-start/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Get started</a>
  </li>
  <ul>
    <li class="collapse show" id="mosnioendocsquick-start">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocsquick-startproxy" href="/mosn.io/en/docs/quick-start/proxy/">Quick start</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-mosnioendocsquick-startistio" href="/mosn.io/en/docs/quick-start/istio/">Istio integration</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/mosn.io/en/docs/concept/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Architecture and principle</a>
  </li>
  <ul>
    <li class="collapse " id="mosnioendocsconcept">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocsconceptcore-concept" href="/mosn.io/en/docs/concept/core-concept/">Core concepts</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocsconceptsidecar-pattern" href="/mosn.io/en/docs/concept/sidecar-pattern/">Sidecar pattern</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocsconcepttraffic-hijack" href="/mosn.io/en/docs/concept/traffic-hijack/">Traffic hijacking</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocsconcepttls" href="/mosn.io/en/docs/concept/tls/">TLS connections</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocsconceptsmooth-upgrade" href="/mosn.io/en/docs/concept/smooth-upgrade/">MOSN hot upgrade</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/mosn.io/en/docs/configuration/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Configuration overview</a>
  </li>
  <ul>
    <li class="collapse " id="mosnioendocsconfiguration">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/mosn.io/en/docs/configuration/listener/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Listener configurations</a>
  </li>
  <ul>
    <li class="collapse " id="mosnioendocsconfigurationlistener">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocsconfigurationlistenerfilter-chain" href="/mosn.io/en/docs/configuration/listener/filter-chain/">FilterChain</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/mosn.io/en/docs/configuration/listener/network-filter/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Network Filter</a>
  </li>
  <ul>
    <li class="collapse " id="mosnioendocsconfigurationlistenernetwork-filter">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocsconfigurationlistenernetwork-filterproxy" href="/mosn.io/en/docs/configuration/listener/network-filter/proxy/">proxy</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocsconfigurationlistenernetwork-filterconnection-manager" href="/mosn.io/en/docs/configuration/listener/network-filter/connection-manager/">connection_manager</a>
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/mosn.io/en/docs/configuration/server/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Server configurations</a>
  </li>
  <ul>
    <li class="collapse " id="mosnioendocsconfigurationserver">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocsconfigurationserverrouter" href="/mosn.io/en/docs/configuration/server/router/">Router configurations</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/mosn.io/en/docs/configuration/trace/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Trace configurations</a>
  </li>
  <ul>
    <li class="collapse " id="mosnioendocsconfigurationtrace">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocsconfigurationtraceskywalking" href="/mosn.io/en/docs/configuration/trace/skywalking/">SkyWalking configurations</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocsconfigurationcustom" href="/mosn.io/en/docs/configuration/custom/">Custom configurations</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocssamples" href="/mosn.io/en/docs/samples/">Example projects</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/mosn.io/en/docs/contribute/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Document contribution</a>
  </li>
  <ul>
    <li class="collapse " id="mosnioendocscontribute">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocscontributegithub" href="/mosn.io/en/docs/contribute/github/">Documentation contribution guide</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocscontributecreating-pages" href="/mosn.io/en/docs/contribute/creating-pages/">Create a page</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocscontributestyle-guide" href="/mosn.io/en/docs/contribute/style-guide/">Format guide</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocsfaq" href="/mosn.io/en/docs/faq/">FAQ</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-mosnioendocscommunity" href="/mosn.io/en/docs/community/">Community</a>
      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">





<a href="https://github.com/mosn/mosn.io/edit/master/content/en/docs/quick-start/istio/index.md" target="_blank"><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/mosn/mosn.io/issues/new?title=Use%20MOSN%20as%20an%20Istio%20data%20plane" target="_blank"><i class="fab fa-github fa-fw"></i> Create documentation issue</a>


<a href="https://github.com/mosn/mosn/issues/new" target="_blank"><i class="fas fa-tasks fa-fw"></i> Create project issue</a>

</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#relationship-between-mosn-and-istio">Relationship between MOSN and Istio</a></li>
    <li><a href="#preparations">Preparations</a>
      <ul>
        <li><a href="#install-hyperkit">Install hyperkit</a></li>
        <li><a href="#install-minikube-or-a-commercial-kubernetes-cluster">Install Minikube (or a commercial Kubernetes cluster)</a></li>
        <li><a href="#start-minikube">Start Minikube</a></li>
        <li><a href="#install-the-kubectl-command-line-tool">Install the kubectl command-line tool</a></li>
        <li><a href="#install-helm">Install Helm</a></li>
      </ul>
    </li>
    <li><a href="#istio-deployment-with-source-code">Istio deployment with source code</a>
      <ul>
        <li><a href="#download-the-sofamesh-source-code">Download the SOFAMesh source code</a></li>
        <li><a href="#install-sofamesh-with-helm">Install SOFAMesh with Helm</a></li>
        <li><a href="#verify-the-installation">Verify the installation</a></li>
        <li><a href="#uninstall">Uninstall</a></li>
      </ul>
    </li>
    <li><a href="#bookinfo-test">Bookinfo test</a>
      <ul>
        <li><a href="#deploy-bookinfo-and-inject-mosn">Deploy Bookinfo and inject MOSN</a></li>
        <li><a href="#access-bookinfo-services">Access Bookinfo services</a></li>
        <li><a href="#verify-routing-by-version-in-mosn">Verify routing by version in MOSN</a></li>
        <li><a href="#verify-routing-by-weight-in-mosn">Verify routing by weight in MOSN</a></li>
        <li><a href="#verify-routing-by-specific-header-in-mosn">Verify routing by specific header in MOSN</a></li>
      </ul>
    </li>
  </ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="/mosn.io/en/en/docs/">Docs</a>
</li>




<li class="breadcrumb-item" >
	<a href="/mosn.io/en/en/docs/quick-start/">Get started</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="/mosn.io/en/en/docs/quick-start/istio/">Istio integration</a>
</li>

	</ol>
</nav	>


            
<div class="td-content">
	<h1>Use MOSN as an Istio data plane</h1>
	<div class="lead">This topic shows you how to build a Service Mesh development environment with MOSN under the Istio framework, and verify the basic routing and load balancing capabilities of MOSN.</div>
	

<div class="pageinfo pageinfo-primary">
<p>MOSN succeeded in the Bookinfo test for Istio 1.1.4. For more information about the support from the latest version of Istio, see <a href="https://github.com/mosn/mosn/issues/933">Issue #933</a>.
<code>Note: After the MOSN 0.14.0 or later can supports xDS, And tested pass all the sample of bookinfo in istio 1.5.2, here is an [MOSN with Istio](https://katacoda.com/mosn/courses/istio/mosn-with-istio) tutorial.</code></p>

</div>

<p>This topic covers the following content:</p>
<ul>
<li>Relationship between MOSN and Istio</li>
<li>Preparations</li>
<li>Istio deployment with source code</li>
<li>Bookinfo test</li>
</ul>
<h2 id="relationship-between-mosn-and-istio">Relationship between MOSN and Istio</h2>
<p>As described in the <a href="../../overview">MOSN overview</a>, MOSN is a service mesh data plane proxy developed in Golang.</p>
<p>The following figure shows the operating principle of MOSN in Istio.</p>
<div align=center><img src="mosn-with-service-mesh.png" width = "450" height = "400" alt="MOSN overview" /></div>
<h2 id="preparations">Preparations</h2>
<p>The operating system described in this topic is macOS. You can install the software versions for your OS, too.</p>
<h3 id="install-hyperkit">Install hyperkit</h3>
<p>Install <a href="https://store.docker.com/editions/community/docker-ce-desktop-mac">docker-for-mac</a> and then <a href="https://github.com/kubernetes/minikube/blob/master/docs/drivers.md">install drivers</a>.</p>
<h4 id="install-docker">Install docker</h4>
<p>Download the software package or run the following command to install it:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew cask install docker
</code></pre></div><h4 id="install-drivers">Install drivers</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -LO https://storage.googleapis.com/minikube/releases/latest/docker-machine-driver-hyperkit <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span><span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> chmod +x docker-machine-driver-hyperkit <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span><span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> sudo mv docker-machine-driver-hyperkit /usr/local/bin/ <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span><span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> sudo chown root:wheel /usr/local/bin/docker-machine-driver-hyperkit <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span><span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> sudo chmod u+s /usr/local/bin/docker-machine-driver-hyperkit
</code></pre></div><h3 id="install-minikube-or-a-commercial-kubernetes-cluster">Install Minikube (or a commercial Kubernetes cluster)</h3>
<p>We recommend that you use Minikube v0.28 or later versions. For more information, go to <a href="https://github.com/kubernetes/minikube">https://github.com/kubernetes/minikube</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew cask install minikube
</code></pre></div><h3 id="start-minikube">Start Minikube</h3>
<p>The pilot requires a memory space of at least 2 GB. Therefore, you can allocate resources to Minikube by adding parameters upon startup. If you do not have sufficient resources on your machine, we recommend that you use the commercial Kubernetes cluster.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ minikube start --memory<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">8192</span> --cpus<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">4</span> --kubernetes-version<span style="color:#ce5c00;font-weight:bold">=</span>v1.15.0 --vm-driver<span style="color:#ce5c00;font-weight:bold">=</span>hyperkit
</code></pre></div><p>Create an Istio namespace</p>
<pre><code>$ kubectl create namespace istio-system
</code></pre><h3 id="install-the-kubectl-command-line-tool">Install the kubectl command-line tool</h3>
<p>kubectl is a command line interface for executing commands against Kubernetes clusters. For details about the installation of kubectl, go to <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl">https://kubernetes.io/docs/tasks/tools/install-kubectl</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew install kubernetes-cli
</code></pre></div><h3 id="install-helm">Install Helm</h3>
<p>Helm is a package management tool of Kubernetes. For details about the installation of Helm, go to <a href="https://docs.helm.sh/using_helm/#installing-helm">https://docs.helm.sh/using_helm/#installing-helm</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ brew install kubernetes-helm
</code></pre></div><h2 id="istio-deployment-with-source-code">Istio deployment with source code</h2>


<div class="pageinfo pageinfo-primary">
<p>SOFAMesh is now directly developed based on Istio to contribute to the Istio community. Development through the fork method is not supported. It will be directly supported by Istio in the future. MOSN succeeded in the Bookinfo test for Istio 1.1.4. For more information about the support from the latest version of Istio, see <a href="https://github.com/mosn/mosn/issues/933">Issue #933</a>.</p>

</div>

<h3 id="download-the-sofamesh-source-code">Download the SOFAMesh source code</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git clone https://github.com/sofastack/sofa-mesh.git
</code></pre></div><h3 id="install-sofamesh-with-helm">Install SOFAMesh with Helm</h3>
<p><strong>Run <code>helm template</code> to install SOFAMesh.</strong></p>
<p>Switch to the directory that stores the Istio source code and then install the Istio CRD and other components with Helm.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#204a87">cd</span> istio
$ helm template install/kubernetes/helm/istio-init --name istio-init --namespace istio-system <span style="color:#000;font-weight:bold">|</span> kubectl apply -f -
$ helm template install/kubernetes/helm/istio --name istio --namespace istio-system <span style="color:#000;font-weight:bold">|</span> kubectl apply -f -
</code></pre></div><h3 id="verify-the-installation">Verify the installation</h3>
<p>If all pods in the <code>istio-system</code> namespace are running, the deployment succeeds.
If you only need to run Bookinfo, running three pods, pilot, injector, and citadel, will suffice your need.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get pods -n istio-system
NAME                                       READY    STATUS   RESTARTS    AGE
istio-citadel-6579c78cd9-w57lr              1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          5m
istio-egressgateway-7649f76df4-zs8kw        1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          5m
istio-galley-c77876cb6-nhczq                1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          5m
istio-ingressgateway-5c9c8565d9-d972t       1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          5m
istio-pilot-7485f9fb4b-xsvtm                1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          5m
istio-policy-5766bc84b9-p2wfj               1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          5m
istio-sidecar-injector-7f5f586bc7-2sdx6     1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          5m
istio-statsd-prom-bridge-7f44bb5ddb-stcf6   1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          5m
istio-telemetry-55ff8c77f4-q8d8q            1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          5m
prometheus-84bd4b9796-nq8lg                 1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          5m
</code></pre></div><h3 id="uninstall">Uninstall</h3>
<p>Uninstall SOFAMesh.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ helm template install/kubernetes/helm/istio --name istio --namespace istio-system <span style="color:#000;font-weight:bold">|</span> kubectl delete -f -
$ kubectl delete namespace istio-system
</code></pre></div><h2 id="bookinfo-test">Bookinfo test</h2>
<p>Bookinfo is a book app. It provides four basic services:</p>
<ul>
<li>Product Page: The product page is developed in python. It displays all book information and calls the Reviews and Details services.</li>
<li>Reviews: The review service is developed in java. It displays book reviews and calls the Ratings service.</li>
<li>Ratings: The rating service is developed in nodejs.</li>
<li>Details: The book details is developed in ruby.</li>
</ul>
<div align=center><img src="bookinfo.png" width = "550" height = "400" alt="bookinfo" /></div>
<h3 id="deploy-bookinfo-and-inject-mosn">Deploy Bookinfo and inject MOSN</h3>
<blockquote>
<p>For details, go to <a href="https://istio.io/docs/examples/bookinfo/">https://istio.io/docs/examples/bookinfo/</a>.</p>
</blockquote>
<p>Inject MOSN</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl label namespace default istio-injection<span style="color:#ce5c00;font-weight:bold">=</span>enabled
</code></pre></div><p>Deploy Bookinfo</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl apply -f samples/bookinfo/platform/kube/bookinfo.yaml
</code></pre></div><p>Verify whether the deployment succeeds</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get services
NAME                       CLUSTER-IP   EXTERNAL-IP   PORT<span style="color:#ce5c00;font-weight:bold">(</span>S<span style="color:#ce5c00;font-weight:bold">)</span>              AGE
details                    10.0.0.31    &lt;none&gt;        9080/TCP             6m
kubernetes                 10.0.0.1     &lt;none&gt;        443/TCP              7d
productpage                10.0.0.120   &lt;none&gt;        9080/TCP             6m
ratings                    10.0.0.15    &lt;none&gt;        9080/TCP             6m
reviews                    10.0.0.170   &lt;none&gt;        9080/TCP             6m
</code></pre></div><p>Wait until all pods are running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get pods
NAME                                        READY     STATUS    RESTARTS   AGE
details-v1-1520924117-48z17                 2/2       Running   <span style="color:#0000cf;font-weight:bold">0</span>          6m
productpage-v1-560495357-jk1lz              2/2       Running   <span style="color:#0000cf;font-weight:bold">0</span>          6m
ratings-v1-734492171-rnr5l                  2/2       Running   <span style="color:#0000cf;font-weight:bold">0</span>          6m
reviews-v1-874083890-f0qf0                  2/2       Running   <span style="color:#0000cf;font-weight:bold">0</span>          6m
reviews-v2-1343845940-b34q5                 2/2       Running   <span style="color:#0000cf;font-weight:bold">0</span>          6m
reviews-v3-1813607990-8ch52                 2/2       Running   <span style="color:#0000cf;font-weight:bold">0</span>          6m
</code></pre></div><h3 id="access-bookinfo-services">Access Bookinfo services</h3>
<p>Enable the gateway mode.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml
$ kubectl get gateway        // Check whether the gateway is running.
NAME               AGE
bookinfo-gateway   24m
</code></pre></div><p>Set GATEWAY_URL. For details, go to <a href="https://istio.io/docs/tasks/traffic-management/ingress/ingress-control/#determining-the-ingress-ip-and-ports">https://istio.io/docs/tasks/traffic-management/ingress/ingress-control/#determining-the-ingress-ip-and-ports</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#204a87">export</span> <span style="color:#000">INGRESS_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl -n istio-system get service istio-ingressgateway -o <span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;{.spec.ports[?(@.name==&#34;http2&#34;)].nodePort}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
$ <span style="color:#204a87">export</span> <span style="color:#000">SECURE_INGRESS_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl -n istio-system get service istio-ingressgateway -o <span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;{.spec.ports[?(@.name==&#34;https&#34;)].nodePort}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
$ <span style="color:#204a87">export</span> <span style="color:#000">INGRESS_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>minikube ip<span style="color:#204a87;font-weight:bold">)</span>
$ <span style="color:#204a87">export</span> <span style="color:#000">GATEWAY_URL</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$INGRESS_HOST</span>:<span style="color:#000">$INGRESS_PORT</span>
</code></pre></div><p>Check whether the gateway takes effect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -o /dev/null -s -w <span style="color:#4e9a06">&#34;%{http_code}\n&#34;</span>  http://<span style="color:#000">$GATEWAY_URL</span>/productpage   // <span style="color:#0000cf;font-weight:bold">200</span> indicates a success. 
<span style="color:#0000cf;font-weight:bold">200</span>
</code></pre></div><p><strong>View the page</strong></p>
<p>Go to <code>http://$GATEWAY_URL/productpage</code> (replace $GATEWAY_URL with your address). The Bookinfo page is shown as follows after you refresh it. Three versions of Book Reviews are available.
The three versions will be displayed in turn when you refresh the page. For more information, go to samples/bookinfo/platform/kube/bookinfo.yaml.</p>
<p>Page v1</p>
<p><img src="v1.png" alt="v1"></p>
<p>Page v2</p>
<p><img src="v2.png" alt="v2"></p>
<p>Page v3</p>
<p><img src="v3.png" alt="v3"></p>
<h3 id="verify-routing-by-version-in-mosn">Verify routing by version in MOSN</h3>
<p>Create a series of destination rules for Bookinfo services.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl apply -f samples/bookinfo/networking/destination-rule-all.yaml
</code></pre></div><p>Specify access to only v1 of the Book Reviews service.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl apply -f samples/bookinfo/networking/virtual-service-all-v1.yaml
</code></pre></div><p>Go to <code>http://$GATEWAY_URL/productpage</code>. You will find that book reviews are now fixed to be displayed on page v1.</p>
<p><img src="v1.png" alt="v1"></p>
<h3 id="verify-routing-by-weight-in-mosn">Verify routing by weight in MOSN</h3>
<p>Allocate 50% of the traffic to v1 and v3 each.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-50-v3.yaml
</code></pre></div><p>Go to <code>http://$GATEWAY_URL/productpage</code>. You will find that page v1 and page v3 are displayed with a possibility of 50% each.</p>
<h3 id="verify-routing-by-specific-header-in-mosn">Verify routing by specific header in MOSN</h3>
<p>The Bookinfo page provides a login entry in the upper-right corner. After you log in, your request will carry the end-user custom field, the value of which is the user name. MOSN supports routing by the value of this header. For example, route user Jason to v2 and others to v1. (The username and password are both jason. For the reason of using this user account, check the corresponding YAML file).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-test-v2.yaml
</code></pre></div><p>When you go to <code>http://$GATEWAY_URL/productpage</code>:</p>
<p>Page v2 will be displayed if you log in as Jason.</p>
<p><img src="login.png" alt="Login"></p>
<p>Page v1 will be displayed if you log in as other users.</p>
<p><img src="v1.png" alt="v1"></p>

	
	
	<div class="text-muted mt-5 pt-3 border-top">Last modified December 3, 2020: <a  href="https://github.com/mosn/mosn.io/commit/706ef2b1b6a7285b942fe72e1c49e29abcf47e3d">fix typo. (706ef2b)</a>
</div>
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-12 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" href="https://twitter.com/MosnProxy">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Mailing list" aria-label="Mailing list">
    <a class="text-white" target="_blank" href="https://groups.google.com/d/forum/mosn-dev">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" href="https://github.com/mosn/mosn">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 The bRPC Authors All Rights Reserved</small>
        
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>






<script src="/mosn.io/js/main.min.898700553302fbaa02c848d097f2458996c9cc39505c8e64b0c7882e71ffad7e.js" integrity="sha256-iYcAVTMC&#43;6oCyEjQl/JFiZbJzDlQXI5ksMeILnH/rX4=" crossorigin="anonymous"></script>





  </body>
</html>